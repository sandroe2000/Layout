<div id="editorBar">
	<div class="sub-menu1">
		<a class="click-btn switch-code" data-toggle="tooltip" data-original-title="Visual / Code"><i class="fa fa-file-code-o"></i></a>
		<span class="separator">|</span>
	</div>
	<div class="sub-menu">
		<a draggable="true" class="action-btn" data-toggle="tooltip" data-original-title="Row"><i class="fa fa-th-list"></i></a>
		<a draggable="true" class="action-btn" data-toggle="tooltip" data-original-title="Col"><i class="fa fa-columns"></i></a>
		<a draggable="true" class="action-btn" data-toggle="tooltip" data-original-title="Nav Tab"><i class="fa fa-folder-o"></i></a>
		<a draggable="true" class="action-btn" data-toggle="tooltip" data-original-title="Accordion"><i class="fa fa-list-alt"></i></a>
		<a draggable="true" class="action-btn" data-toggle="tooltip" data-original-title="DataTable"><i class="fa fa-table"></i></a>
		<span class="separator">|</span>
		<a draggable="true" class="action-btn" data-toggle="tooltip" data-original-title="Label"><i class="fa fa-font"></i></a>
		<a draggable="true" class="action-btn" data-toggle="tooltip" data-original-title="Input Text"><i class="fa fa-pencil"></i></a>
		<a draggable="true" class="action-btn" data-toggle="tooltip" data-original-title="Input E-mail"><i class="fa fa-envelope-o"></i></a>
		<a draggable="true" class="action-btn" data-toggle="tooltip" data-original-title="Input Password"><i class="fa fa-ellipsis-h"></i></a>
		<a draggable="true" class="action-btn" data-toggle="tooltip" data-original-title="Input Date"><i class="fa fa-calendar"></i></a>
		<a draggable="true" class="action-btn" data-toggle="tooltip" data-original-title="Input Number"><i class="fa fa-sort"></i></a>
		<a draggable="true" class="action-btn" data-toggle="tooltip" data-original-title="Input Range"><i class="fa fa-sliders"></i></a>
		<a draggable="true" class="action-btn" data-toggle="tooltip" data-original-title="Input Checkbox"><i class="fa fa-check-square-o"></i></a>
		<a draggable="true" class="action-btn" data-toggle="tooltip" data-original-title="Input Radio"><i class="fa fa-dot-circle-o"></i></a>
		<a draggable="true" class="action-btn" data-toggle="tooltip" data-original-title="Select"><i class="fa fa-pencil-square-o"></i></a>
		<a draggable="true" class="action-btn" data-toggle="tooltip" data-original-title="Select"><i class="fa fa-bars"></i></a>
		<a draggable="true" class="action-btn" data-toggle="tooltip" data-original-title="Button"><i class="fa fa-square"></i></a>
	</div>
</div>
<div id="editor"></div>
<div id="visual"></div>
<script>

	var editor = null;

	$(document).ready(function() {
		require(['vs/editor/editor.main'], function () {

			loadSample({
				modeId: getLanguageId(sourceContentInEdition),
				sampleURL: sourceContentInEdition
			});

		});

		window.onresize = resizeEditor();

		function resizeEditor(){
			if (editor) {
				editor.layout();
			}
		}
	});

	$('.switch-code').click(function(event){
		$(this).find('i').toggleClass('fa fa-file-code-o fa fa-eye');
		$('.sub-menu').toggle('active');
		$('#editor').toggle('show-hide');
		$('#visual').toggle('show-hide');

		let left = document.querySelector('.sub-menu');
		let right = document.querySelector('#visual');

		dragula([left, right], {
			copy: true,
			accepts: function (el, target) {
				return target !== document.getElementById(left)
			}
		});

	});

	$('[data-toggle="tooltip"]').tooltip();

	function getLanguageId(editFile){

		let ext = editFile.split('.').pop();
		if(ext=='js'){  
			ext = 'javascript';
		}
		return ext;
	}

	var preloaded = {};
	(function() {
		var elements = Array.prototype.slice.call(document.querySelectorAll('pre[data-preload]'), 0);

		elements.forEach(function(el) {
			var path = el.getAttribute('data-preload');
			preloaded[path] = el.innerText || el.textContent;
			el.parentNode.removeChild(el);
		});
	})();

	function xhr(url, cb) {
		if (preloaded[url]) {
			return cb(null, preloaded[url]);
		}

		fetch(sourceContentInEdition)
		.then(function(response) {
			return response.text();
		})
		.then(function(data) {
			cb(null, data);
		});
	}

	function loadSample(mode) {

		$('.loading.editor').show();
		xhr(mode.sampleURL, function(err, data) {
			if (err) {
				if (editor) {
					if (editor.getModel()) {
						editor.getModel().dispose();
					}
					editor.dispose();
					editor = null;
				}
				$('.loading.editor').fadeOut({ duration: 200 });
				$('#editor').empty();
				$('#editor').append('<p class="alert alert-error">Failed to load ' + mode.modeId + ' sample</p>');
				return;
			}

			if (!editor) {
				$('#editor').empty();
				editor = monaco.editor.create(document.getElementById('editor'), {
					model: null,
				});
			}

			var oldModel = editor.getModel();
			var newModel = monaco.editor.createModel(data, mode.modeId);
			editor.setModel(newModel);
			if (oldModel) {
				oldModel.dispose();
			}
			monaco.editor.setTheme('vs-dark');
			$('.loading.editor').fadeOut({ duration: 300 });
		})
	}

	function loadDiffSample() {

		var onError = function() {
			$('.loading.diff-editor').fadeOut({ duration: 200 });
			$('#diff-editor').append('<p class="alert alert-error">Failed to load diff editor sample</p>');
		};

		$('.loading.diff-editor').show();

		var lhsData = null, rhsData = null, jsMode = null;

		xhr('index/samples/diff.lhs.txt', function(err, data) {
			if (err) {
				return onError();
			}
			lhsData = data;
			onProgress();
		})
		xhr('index/samples/diff.rhs.txt', function(err, data) {
			if (err) {
				return onError();
			}
			rhsData = data;
			onProgress();
		})

		function onProgress() {
			if (lhsData && rhsData) {
				diffEditor = monaco.editor.createDiffEditor(document.getElementById('diff-editor'), {
					enableSplitViewResizing: false
				});

				var lhsModel = monaco.editor.createModel(lhsData, 'text/javascript');
				var rhsModel = monaco.editor.createModel(rhsData, 'text/javascript');

				diffEditor.setModel({
					original: lhsModel,
					modified: rhsModel
				});

				$('.loading.diff-editor').fadeOut({ duration: 300 });
			}
		}
	}

	function changeTheme(theme) {
		var newTheme = (theme === 1 ? 'vs-dark' : ( theme === 0 ? 'vs' : 'hc-black' ));
		monaco.editor.setTheme(newTheme);
	}

</script>